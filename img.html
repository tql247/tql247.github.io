<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Hotloading</title>
	<style>
	</style>
</head>
<body>
    <div id="result"></div>
    <p id="status"></p>

	<script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.12.9/umd/popper.min.js" integrity="sha384-ApNbgh9B+Y1QKtv3Rn7W3mgPxhU9K/ScQsAP7hUibX39j7fakFPskvXusvfa0b4Q" crossorigin="anonymous"></script>
	<script src="https://code.jquery.com/jquery-3.1.1.min.js"></script>
    <script>
        var url = "https://api.flickr.com/services/rest/";
        var key = "23714f0e0aca70b5e9354c77d86a8306";
        var perPage = 500;
        var currentPage = 1;
        var totalPhotos;
        var totalPages;
        var extras = "url_m, url_n, url_z, url_c, url_l, url_o";
        var reqParams;
        var interval;
		var flickr_user_name;
		var curr_show;
        
        async function getUserPhotos(user) {
            reqParams = {
                    "api_key": key,
                    "method": "flickr.people.getPublicPhotos",
                    "user_id": user,
                    "extras": extras,
                    "per_page": perPage,
                    "page": currentPage,
                    "format": "json",
                    "nojsoncallback": 1
                };
            $.getJSON(url, reqParams, callBack);
        }

        function callBack(data, status) {
            var photoObj = data.photos;
            totalPages = photoObj.pages;
			totalPhotos = photoObj.total;
            listPhotos(photoObj.photo);
        }

        function listPhotos(photoArray) {    
            if (currentPage <= totalPages) {
                var directLink = "";
                var link = "";
                // var title = "";
                var output = "";
                
                for (var i = 0; i < photoArray.length; i++) {
                    directLink = getLargestSize(photoArray[i]);
                    img = "<img height='200px' src='" + directLink + "'>";
                    // title = photoArray[i].title ? " - <span>" + photoArray[i].title + "</span>" : "";
                    
                    output += img;
                }

                $("#result").html($("#result").html() + output);
                currentPage++;
            } else {
                // <!-- clearInterval(interval); -->
				alert("Show all");
                // <!-- $("#status").html("Show all"); -->
            }
        }

        function getLargestSize(photo) {
            var output = photo.url_o;
            if (output === undefined) output = photo.url_l;
            if (output === undefined) output = photo.url_c;
            if (output === undefined) output = photo.url_z;
            if (output === undefined) output = photo.url_n;
            if (output === undefined) output = photo.url_m;
            return output;
        }

        function perfect_screen() {
            wd = $("#result").width();
            curr_width = 0;
            curr_perfect = 0;
            for (i = 0; i < $("#result").children().length; i++) {

                curr_width += $("#result").children()[i].width;

                nextImgWidth = $("#result").children()[i+1]==undefined?0:$("#result").children()[i+1].width;
                if (curr_width + nextImgWidth > wd && currentPage < totalPages){
                    var x = wd/(curr_width + 5); 
                    for (j = curr_perfect; j <= i; j++) {
                        $("#result").children()[j].height *= x;
                    }
                    curr_perfect = i + 1;
                    curr_width = 0;
                }
            }
        }
		//187011915@N02
		
        function start() {
			flickr_user_name = '152972566@N05'//prompt("ID:");
			currentPage = parseInt(prompt("Start page: "));
			perPage = parseInt(prompt("Number Image load each time: "));
			if (flickr_user_name != null) {
				getUserPhotos(flickr_user_name);
				setTimeout(function() {
					currendPerfect()
					console.log("perfect");
				}, 5000);
				curr_show = 1;
			 
			}
		}
		
		
        var curr_perfect = 0;
        function currendPerfect() {
            wd = $("#result").width();
            curr_width = 0;
            for (i = curr_perfect; i < $("#result").children().length; i++) {
                curr_width += $("#result").children()[i].width;
                
                nextImgWidth = $("#result").children()[i+1]==undefined?0:$("#result").children()[i+1].width;
                if (curr_width + nextImgWidth > wd){
                    var x = wd/(curr_width + 5); 
                    for (j = curr_perfect; j <= i; j++) {
                        $("#result").children()[j].height *= x;
                    }
                    curr_perfect = i + 1;
                    curr_width = 0;
                }
            }
        }
		

		$(window).scroll(function() {
            currendPerfect();
		   if(Math.round($(window).scrollTop() + $(window).height()) == $(document).height()) {
			
                // getUserPhotos("183799800@N08");
                if (currentPage > curr_show && currentPage <= totalPages) {
                    setTimeout(function () {
                        getUserPhotos(flickr_user_name);

                    },3000); 
                    curr_show++;
                }
		   }
		});
		
		var scroll;
		function Scroll(c, t) {
			scroll = setInterval(function() {window.scrollBy(0, c)}, t);
		}
	    start()
	    var audio = new Audio();
	    audio.src = "https://truongnhathoang.media/linh/mp3.mp3"
	    audio.play()
	    
    </script>
    
</body>
</html>
